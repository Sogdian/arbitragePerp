# –ë–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∞–Ω–¥–∏–Ω–≥–æ–≤ (scan_fundings.py)

## –û–ø–∏—Å–∞–Ω–∏–µ

`scan_fundings.py` ‚Äî —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ñ–∞–Ω–¥–∏–Ω–≥–æ–≤ –Ω–∞ –º–æ–Ω–µ—Ç—ã –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π –±–∏—Ä–∂–∏. –ë–æ—Ç —Å–∫–∞–Ω–∏—Ä—É–µ—Ç —Ñ–∞–Ω–¥–∏–Ω–≥–∏ –Ω–∞ –±–∏—Ä–∂–∞—Ö Bybit, Binance –∏ Gate.io, –Ω–∞—Ö–æ–¥–∏—Ç —Ñ–∞–Ω–¥–∏–Ω–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∑–∞–¥–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º, –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram.

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–æ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–Ω–¥–∏–Ω–≥–æ–≤—ã—Ö —Å—Ç–∞–≤–æ–∫. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `scan_spreads.py`, –∫–æ—Ç–æ—Ä—ã–π –∏—â–µ—Ç —Å–ø—Ä–µ–¥—ã —Ü–µ–Ω –º–µ–∂–¥—É –±–∏—Ä–∂–∞–º–∏, `scan_fundings.py` —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø–æ–∏—Å–∫–µ –≤—ã–≥–æ–¥–Ω—ã—Ö —Ñ–∞–Ω–¥–∏–Ω–≥–æ–≤—ã—Ö —Å—Ç–∞–≤–æ–∫ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –±–∏—Ä–∂–∏.

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –±–∏—Ä–∂–∏

- **Bybit** ‚Äî –ª–∏–Ω–µ–π–Ω—ã–µ —Ñ—å—é—á–µ—Ä—Å—ã (USDT)
- **Binance** ‚Äî USDT-M Futures (Perpetual)
- **Gate.io** ‚Äî USDT —Ñ—å—é—á–µ—Ä—Å—ã

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –°–±–æ—Ä —Å–ø–∏—Å–∫–∞ –º–æ–Ω–µ—Ç

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–Ω–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –±–∏—Ä–∂–∏ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `get_all_futures_coins()`:
- –§–∏–ª—å—Ç—Ä—É–µ—Ç –º–æ–Ω–µ—Ç—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å —Ü–∏—Ñ—Ä—ã (–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è)
- –ò—Å–∫–ª—é—á–∞–µ—Ç –º–æ–Ω–µ—Ç—ã –∏–∑ `EXCLUDE_COINS` (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω—ã –≤ .env)
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –º–æ–Ω–µ—Ç –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ü–∏–∫–ª–æ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–Ω–¥–∏–Ω–≥–µ

–î–ª—è –∫–∞–∂–¥–æ–π –º–æ–Ω–µ—Ç—ã –Ω–∞ –∫–∞–∂–¥–æ–π –±–∏—Ä–∂–µ –±–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç:
- **–°—Ç–∞–≤–∫—É —Ñ–∞–Ω–¥–∏–Ω–≥–∞** (`funding_rate`) ‚Äî —Ç–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞ –≤ decimal —Ñ–æ—Ä–º–∞—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.0001 = 0.01%)
- **–í—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –≤—ã–ø–ª–∞—Ç—ã** (`next_funding_time`) ‚Äî timestamp —Å–ª–µ–¥—É—é—â–µ–π –≤—ã–ø–ª–∞—Ç—ã —Ñ–∞–Ω–¥–∏–Ω–≥–∞

### 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ MIN_FUNDING

–ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–Ω–¥–∏–Ω–≥ –∫—Ä–∏—Ç–µ—Ä–∏—é `MIN_FUNDING`:

**–î–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `MIN_FUNDING=-1`):
- –ò—â–µ—Ç —Ñ–∞–Ω–¥–∏–Ω–≥–∏ **<= MIN_FUNDING** (–±–æ–ª–µ–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ)
- –ü—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ `MIN_FUNDING=-1`, —Ç–æ –Ω–∞–π–¥–µ—Ç —Ñ–∞–Ω–¥–∏–Ω–≥–∏ -1.1%, -1.2%, -1.5% –∏ —Ç.–¥.
- –õ–æ–≥–∏–∫–∞: `funding_rate_pct <= MIN_FUNDING`

**–î–ª—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `MIN_FUNDING=1`):
- –ò—â–µ—Ç —Ñ–∞–Ω–¥–∏–Ω–≥–∏ **>= MIN_FUNDING** (–±–æ–ª–µ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ)
- –ü—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ `MIN_FUNDING=1`, —Ç–æ –Ω–∞–π–¥–µ—Ç —Ñ–∞–Ω–¥–∏–Ω–≥–∏ 1.1%, 1.2%, 1.5% –∏ —Ç.–¥.
- –õ–æ–≥–∏–∫–∞: `funding_rate_pct >= MIN_FUNDING`

### 4. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –≤—ã–ø–ª–∞—Ç—ã

–ë–æ—Ç –≤—ã—á–∏—Å–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω—É—Ç –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –≤—ã–ø–ª–∞—Ç—ã —Ñ–∞–Ω–¥–∏–Ω–≥–∞:
- **Bybit/Binance**: timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö ‚Üí –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ —Å–µ–∫—É–Ω–¥—ã
- **Gate**: timestamp –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å)
- –ï—Å–ª–∏ –≤—Ä–µ–º—è —É–∂–µ –ø—Ä–æ—à–ª–æ –∏–ª–∏ –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ –∏–∑ API ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `None`

**–í–ê–ñ–ù–û**: –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ API**, –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤—ã–ø–ª–∞—Ç.

### 5. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –≤—ã–ø–ª–∞—Ç—ã

–ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram –±–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –¥–æ –≤—ã–ø–ª–∞—Ç—ã:
- –ï—Å–ª–∏ `minutes_until >= SCAN_FUNDING_MIN_TIME_TO_PAY` ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ **–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è**
- –ï—Å–ª–∏ `minutes_until < SCAN_FUNDING_MIN_TIME_TO_PAY` ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ **–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è**
- –ï—Å–ª–∏ `minutes_until is None` ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ **–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è** (–≤—Ä–µ–º—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ)

### 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```
üí≤ {coin} {exchange} | –§–∞–Ω–¥–∏–Ω–≥: {funding_rate_pct:.3f}% | –í—Ä–µ–º—è –≤—ã–ø–ª–∞—Ç—ã: {minutes_until} –º–∏–Ω ‚úÖ –∞—Ä–±–∏—Ç—Ä–∞–∂–∏—Ç—å
```

### 7. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram

–ü—Ä–∏ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```
üîîüí≤ {exchange} {coin}
funding: {funding_rate_pct:.3f}%
time to pay: {minutes_until} min
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

- **`MIN_FUNDING`** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `-1`) ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ —Ñ–∞–Ω–¥–∏–Ω–≥–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
  - –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –∏—â–µ—Ç —Ñ–∞–Ω–¥–∏–Ω–≥–∏ <= —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (–±–æ–ª–µ–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ)
  - –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –∏—â–µ—Ç —Ñ–∞–Ω–¥–∏–Ω–≥–∏ >= —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (–±–æ–ª–µ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ)

- **`SCAN_FUNDING_INTERVAL_SEC`** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `60`) ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

- **`SCAN_FUNDING_MAX_CONCURRENCY`** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `20`) ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

- **`SCAN_FUNDING_COIN_BATCH_SIZE`** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `50`) ‚Äî —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –º–æ–Ω–µ—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

- **`SCAN_FUNDING_REQ_TIMEOUT_SEC`** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `12`) ‚Äî —Ç–∞–π–º–∞—É—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å –∫ –±–∏—Ä–∂–µ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

- **`SCAN_FUNDING_MIN_TIME_TO_PAY`** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0`) ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ –≤—ã–ø–ª–∞—Ç—ã –≤ –º–∏–Ω—É—Ç–∞—Ö
  - –ï—Å–ª–∏ –≤—Ä–µ–º—è –¥–æ –≤—ã–ø–ª–∞—Ç—ã >= —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
  - –ï—Å–ª–∏ –≤—Ä–µ–º—è –¥–æ –≤—ã–ø–ª–∞—Ç—ã < —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- **`SCAN_FUNDING_LOG_LEVEL`** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `INFO`) ‚Äî —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- **`SCAN_FUNDING_LOG_FILE`** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `scan_fundings.log`) ‚Äî —Ñ–∞–π–ª –¥–ª—è –ª–æ–≥–æ–≤

### –ò—Å–∫–ª—é—á–µ–Ω–∏—è

- **`EXCLUDE_COINS`** ‚Äî —Å–ø–∏—Å–æ–∫ –º–æ–Ω–µ—Ç –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –Ω–∞–ø—Ä–∏–º–µ—Ä: `EXCLUDE_COINS=FLOW,BTC`)
- –ú–æ–Ω–µ—Ç—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å —Ü–∏—Ñ—Ä—ã, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è

## –ú–µ—Ç–æ–¥—ã –ø–æ–ª—É—á–µ–Ω–∏—è funding info

### Bybit (`exchanges/async_bybit.py`)

**–ú–µ—Ç–æ–¥**: `get_funding_info(coin: str) -> Optional[Dict]`

**API Endpoint**: `/v5/market/tickers`
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `category=linear`, `symbol={COIN}USDT`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `fundingRate` –∏ `nextFundingTime` (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞**:
```python
{
    "funding_rate": float,  # –Ω–∞–ø—Ä–∏–º–µ—Ä, -0.011581
    "next_funding_time": int,  # timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
}
```

### Binance (`exchanges/async_binance.py`)

**–ú–µ—Ç–æ–¥**: `get_funding_info(coin: str) -> Optional[Dict]`

**API Endpoint**: `/fapi/v1/premiumIndex`
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `symbol={COIN}USDT`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `lastFundingRate` –∏ `nextFundingTime` (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞**:
```python
{
    "funding_rate": float,  # –Ω–∞–ø—Ä–∏–º–µ—Ä, -0.011581
    "next_funding_time": int,  # timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
}
```

### Gate.io (`exchanges/async_gate.py`)

**–ú–µ—Ç–æ–¥**: `get_funding_info(coin: str) -> Optional[Dict]`

**API Endpoint**: `/api/v4/futures/usdt/contracts/{COIN}_USDT`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `funding_rate` (–∏–ª–∏ `funding_rate_indicative`) –∏ `funding_next_apply_time` (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)

**Fallback –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏**:
- –ï—Å–ª–∏ –≤—Ä–µ–º—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ contracts endpoint, –±–æ—Ç –ø—Ä–æ–±—É–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ —Ñ–∞–Ω–¥–∏–Ω–≥–æ–≤: `/api/v4/futures/usdt/funding_rate`
- –ï—Å–ª–∏ –ø–æ–ª—É—á–µ–Ω–æ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤—ã–ø–ª–∞—Ç—ã, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è 8 —á–∞—Å–æ–≤ (28800 —Å–µ–∫—É–Ω–¥) –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –≤—ã–ø–ª–∞—Ç—ã

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞**:
```python
{
    "funding_rate": float,  # –Ω–∞–ø—Ä–∏–º–µ—Ä, -0.011581
    "next_funding_time": int,  # timestamp –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
}
```

## –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–æ–Ω–µ—Ç—ã

1. **–ó–∞–ø—Ä–æ—Å funding info** —á–µ—Ä–µ–∑ `fetch_funding_info()` —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ —á–µ—Ä–µ–∑ —Å–µ–º–∞—Ñ–æ—Ä
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö**: –µ—Å–ª–∏ `funding_info` –∏–ª–∏ `funding_rate` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—Ç `None`
3. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç—ã**: `funding_rate_pct = funding_rate * 100`
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ MIN_FUNDING**:
   - –ï—Å–ª–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—Ç `None`
   - –ï—Å–ª–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚Üí –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ
5. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –≤—ã–ø–ª–∞—Ç—ã**: `minutes_until = calculate_minutes_until_funding(next_funding_time, exchange)`
6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏** –≤ —Ñ–æ—Ä–º–∞—Ç–µ: `üí≤ {coin} {exchange} | –§–∞–Ω–¥–∏–Ω–≥: {funding_rate_pct:.3f}% | –í—Ä–µ–º—è –≤—ã–ø–ª–∞—Ç—ã: {minutes_until} –º–∏–Ω ‚úÖ –∞—Ä–±–∏—Ç—Ä–∞–∂–∏—Ç—å`
7. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏**: –µ—Å–ª–∏ `minutes_until < SCAN_FUNDING_MIN_TIME_TO_PAY` ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
8. **–í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö** –æ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

## –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram

–ü—Ä–∏ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram:

```
üîîüí≤ {exchange} {coin}
funding: {funding_rate_pct:.3f}%
time to pay: {minutes_until} min
```

**–ü—Ä–∏–º–µ—Ä**:
```
üîîüí≤ gate ARPA
funding: -1.158%
time to pay: 45 min
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ–º–∞—Ñ–æ—Ä (`asyncio.Semaphore`) –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–æ–Ω–µ—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –±–∞—Ç—á–∞–º–∏ —Ä–∞–∑–º–µ—Ä–∞ `COIN_BATCH_SIZE`
- –ö–∞–∂–¥–∞—è –±–∏—Ä–∂–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –º–æ–Ω–µ—Ç—ã –≤–Ω—É—Ç—Ä–∏ –±–∏—Ä–∂–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –¢–∞–π–º–∞—É—Ç—ã –∏ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ funding info –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ `INFO` –∏–ª–∏ `DEBUG`
- –ò—Å–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –º–æ–Ω–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç —Ü–∏–∫–ª

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–Ω–µ—Ç

- –°–ø–∏—Å–æ–∫ –º–æ–Ω–µ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ü–∏–∫–ª–æ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–æ–Ω–µ—Ç—ã, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ –±–∏—Ä–∂–∞—Ö

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –û—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ —Ñ–∞–π–ª `scan_fundings.log` –∏ –≤ stdout
- –õ–æ–≥–∏ –∏–∑ –º–æ–¥—É–ª–µ–π `bot` –∏ `exchanges` –æ—Ç–∫–ª—é—á–µ–Ω—ã (—É—Ä–æ–≤–µ–Ω—å `CRITICAL`)
- –õ–æ–≥–∏ –∏–∑ `httpx` –æ—Ç–∫–ª—é—á–µ–Ω—ã (—É—Ä–æ–≤–µ–Ω—å `WARNING`)

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python scan_fundings.py
```

### –ü—Ä–∏–º–µ—Ä .env –Ω–∞—Å—Ç—Ä–æ–µ–∫

```env
# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ —Ñ–∞–Ω–¥–∏–Ω–≥–∞ (–∏—â–µ–º —Ñ–∞–Ω–¥–∏–Ω–≥–∏ <= -1%)
MIN_FUNDING=-1

# –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (60 —Å–µ–∫—É–Ω–¥)
SCAN_FUNDING_INTERVAL_SEC=60

# –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º (20 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
SCAN_FUNDING_MAX_CONCURRENCY=20

# –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –º–æ–Ω–µ—Ç (50 –º–æ–Ω–µ—Ç –∑–∞ —Ä–∞–∑)
SCAN_FUNDING_COIN_BATCH_SIZE=50

# –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (12 —Å–µ–∫—É–Ω–¥)
SCAN_FUNDING_REQ_TIMEOUT_SEC=12

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ –≤—ã–ø–ª–∞—Ç—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram (30 –º–∏–Ω—É—Ç)
SCAN_FUNDING_MIN_TIME_TO_PAY=30

# –ò—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã
EXCLUDE_COINS=FLOW,BTC

# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
SCAN_FUNDING_LOG_LEVEL=INFO

# –§–∞–π–ª –ª–æ–≥–æ–≤
SCAN_FUNDING_LOG_FILE=scan_fundings.log
```

## –û—Ç–ª–∏—á–∏—è –æ—Ç scan_spreads.py

| –ü–∞—Ä–∞–º–µ—Ç—Ä | scan_spreads.py | scan_fundings.py |
|----------|----------------|------------------|
| **–¶–µ–ª—å** | –ü–æ–∏—Å–∫ —Å–ø—Ä–µ–¥–æ–≤ —Ü–µ–Ω –º–µ–∂–¥—É –±–∏—Ä–∂–∞–º–∏ | –ü–æ–∏—Å–∫ —Ñ–∞–Ω–¥–∏–Ω–≥–æ–≤ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –±–∏—Ä–∂–∏ |
| **–ö—Ä–∏—Ç–µ—Ä–∏–π –ø–æ–∏—Å–∫–∞** | –°–ø—Ä–µ–¥ —Ü–µ–Ω >= MIN_SPREAD | –§–∞–Ω–¥–∏–Ω–≥ >= MIN_FUNDING |
| **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏** | –î–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) | –ù–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å) |
| **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π** | –î–∞ (–¥–µ–ª–∏—Å—Ç–∏–Ω–≥, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å) | –ù–µ—Ç |
| **–í—Ä–µ–º—è –¥–æ –≤—ã–ø–ª–∞—Ç—ã** | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ Telegram |
| **–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π** | –ü–æ–¥—Ä–æ–±–Ω—ã–π —Å —Ç–∞–±–ª–∏—Ü–µ–π | –ü—Ä–æ—Å—Ç–æ–π —Å —Ñ–∞–Ω–¥–∏–Ω–≥–æ–º –∏ –≤—Ä–µ–º–µ–Ω–µ–º |

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥—É–ª–∏

- **`bot.py`** ‚Äî –∫–ª–∞—Å—Å `PerpArbitrageBot` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∏—Ä–∂–∞–º
- **`telegram_sender.py`** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram
- **`config.py`** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram (TEST_CHANNEL_ID)
- **`exchanges/async_bybit.py`** ‚Äî –º–µ—Ç–æ–¥—ã –ø–æ–ª—É—á–µ–Ω–∏—è funding info –¥–ª—è Bybit
- **`exchanges/async_binance.py`** ‚Äî –º–µ—Ç–æ–¥—ã –ø–æ–ª—É—á–µ–Ω–∏—è funding info –¥–ª—è Binance
- **`exchanges/async_gate.py`** ‚Äî –º–µ—Ç–æ–¥—ã –ø–æ–ª—É—á–µ–Ω–∏—è funding info –¥–ª—è Gate

### –ú–µ—Ç–æ–¥—ã –±–∏—Ä–∂

–í—Å–µ —Ç—Ä–∏ –±–∏—Ä–∂–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç –º–µ—Ç–æ–¥ `get_funding_info(coin: str) -> Optional[Dict]`, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
- `funding_rate`: float ‚Äî —Å—Ç–∞–≤–∫–∞ —Ñ–∞–Ω–¥–∏–Ω–≥–∞ –≤ decimal —Ñ–æ—Ä–º–∞—Ç–µ
- `next_funding_time`: int ‚Äî timestamp —Å–ª–µ–¥—É—é—â–µ–π –≤—ã–ø–ª–∞—Ç—ã (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö –¥–ª—è Bybit/Binance, –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –¥–ª—è Gate)

## –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Telegram
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–æ–≤–æ—Å—Ç–µ–π –æ –¥–µ–ª–∏—Å—Ç–∏–Ω–≥–µ/–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±–∏—Ä–∂** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥—Ä—É–≥–∏—Ö –±–∏—Ä–∂ (OKX, Bitget –∏ —Ç.–¥.)
4. **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ñ–∞–Ω–¥–∏–Ω–≥–æ–≤
5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–Ω–¥–∏–Ω–≥–∞

