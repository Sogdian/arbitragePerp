# –°—Ö–µ–º–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —à–æ—Ä—Ç–∞ (–ø–æ –ª–æ–≥–∞–º)

## –í—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è —Å–æ–±—ã—Ç–∏–π

```
13:59:17 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ‚îÇ üí∏ FUNDING CONTEXT
         ‚îÇ   - funding_rate = -0.564404%
         ‚îÇ   - qty = 50 MMT
         ‚îÇ   - notional ~ 12.448 USDT
         ‚îÇ
         ‚îÇ üßÆ ENTRY PLAN (bps)
         ‚îÇ   - entry_bps_plan = 90.8
         ‚îÇ   - –§–æ—Ä–º—É–ª–∞: 30 + 0.9 * 56.44 = 90.8 bps
         ‚îÇ   (—ç—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π –¥—Ä–æ–ø –¥–ª—è –≤—Ö–æ–¥–∞)
         ‚îÇ
         ‚îÇ üïí NEXT FUNDING: 1769173200000 (server ms)
         ‚îÇ   = 14:00:00 –ø–æ server-time
         ‚îÇ
13:59:18 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ‚îÇ üìç Baseline short BEFORE window
         ‚îÇ   - REST –∑–∞–ø—Ä–æ—Å: —Ç–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è
         ‚îÇ   - short_before = 0 MMT
         ‚îÇ   (–¥–µ–ª–∞–µ—Ç—Å—è –î–û –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–∫–Ω–∞)
         ‚îÇ
         ‚îÇ üîå –ó–∞–ø—É—Å–∫ WebSocket:
         ‚îÇ   - Public WS (orderbook + trades + tickers)
         ‚îÇ   - Trade WS (order.create)
         ‚îÇ   - Private WS (order/execution/position)
         ‚îÇ
13:59:19-24 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ‚îÇ ‚úÖ –í—Å–µ WS –≥–æ—Ç–æ–≤—ã –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã
         ‚îÇ
         ‚îÇ üß≠ positionIdx = 0 (one-way mode)
         ‚îÇ
         ‚îÇ ‚è≥ –ñ–¥—ë–º –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ (–¥–æ 13:59:57)
         ‚îÇ
13:59:57 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ‚îÇ ‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ isolated/leverage (–ø—Ä–æ–ø—É—â–µ–Ω–∞ –¥–ª—è unified)
         ‚îÇ
13:59:59 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ‚îÇ üìå WS FIX (–∑–∞ 30ms –¥–æ payout)
         ‚îÇ   - WS snapshot: close_price = 0.25018
         ‚îÇ   - best_bid = 0.25019
         ‚îÇ   - best_ask = 0.25022
         ‚îÇ   - staleness = 1.0ms (—Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ)
         ‚îÇ
         ‚îÇ üí∏ FUNDING (fixed pre-payout): -0.564404%
         ‚îÇ
         ‚îÇ üß∑ OPEN PREPARED
         ‚îÇ   - ref_px = min(close_price, best_bid) = 0.25018
         ‚îÇ   - entry_bps_plan = 90.8
         ‚îÇ   - limit_px = 0.24789 (—Ä–∞—Å—Å—á–∏—Ç–∞–Ω –∑–∞—Ä–∞–Ω–µ–µ)
         ‚îÇ   - qty = 50
         ‚îÇ
         ‚îÇ ‚ö†Ô∏è –í–ê–ñ–ù–û: limit_px —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –æ—Ç ref_px (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
         ‚îÇ   –ù–æ –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ —Ü–µ–Ω–∞ –±–µ—Ä—ë—Ç—Å—è –æ—Ç best_bid_open –≤ –º–æ–º–µ–Ω—Ç SEND
         ‚îÇ
13:59:59.255 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ‚îÇ üöÄ OPEN SEND (Sell IOC)
         ‚îÇ   - –í—Ä–µ–º—è: payout - 30ms (OPEN_EARLY_MS)
         ‚îÇ   - limit_px = 0.24789
         ‚îÇ   - qty = 50
         ‚îÇ   - staleness = 3ms
         ‚îÇ
         ‚îÇ   –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Trade WS:
         ‚îÇ   ‚îî‚îÄ> create_order(order, server_ts_ms, timeout=0.5s)
         ‚îÇ
13:59:59.438 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ‚îÇ ‚úÖ OPEN ACK (trade ws)
         ‚îÇ   - order_id = 4d501774-a48d-47ac-b89a-0e7be426464b
         ‚îÇ   - –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: ~183ms (–æ—Ç SEND –¥–æ ACK)
         ‚îÇ
13:59:59.495 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ‚îÇ ‚úÖ OPEN FILLED (private ws)
         ‚îÇ   - order_id = 4d501774-...
         ‚îÇ   - filled_qty = 50 (–ø–æ–ª–Ω–æ—Å—Ç—å—é)
         ‚îÇ   - avg_price = 0.24944
         ‚îÇ   - –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: ~240ms (–æ—Ç SEND –¥–æ FILLED)
         ‚îÇ
14:00:00.455 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ‚îÇ üìç CLOSE PLAN
         ‚îÇ   - –ò—Å–ø–æ–ª—å–∑—É–µ–º open_filled_qty = 50 (–∏–∑ private WS)
         ‚îÇ   - –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∑–∏—Ü–∏—é (–±—ã—Å—Ç—Ä–µ–µ)
         ‚îÇ
         ‚îÇ üõí –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
         ‚îÇ   - Buy IOC, qty = 50
         ‚îÇ   - px = 0.25017
         ‚îÇ
14:00:00.640 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ‚îÇ ‚úÖ Short –∑–∞–∫—Ä—ã—Ç
         ‚îÇ   - avg_exit_buy = 0.25015
         ‚îÇ
         ‚îÇ üì¶ WS executions cache
         ‚îÇ   - 2 items (buy + sell)
         ‚îÇ
         ‚îÇ üìä –ò—Ç–æ–≥
         ‚îÇ   - avg_buy = 0.25015
         ‚îÇ   - avg_sell = 0.24944
         ‚îÇ   - PnL = -0.06 USDT (—É–±—ã—Ç–æ–∫ –∏–∑-–∑–∞ —Å–ø—Ä–µ–¥–∞)
```

## –ß—Ç–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –î–û –æ—Ç–∫—Ä—ã—Ç–∏—è

### 1. Entry Plan (bps)
```
entry_bps_plan = ENTRY_BASE_BPS + ENTRY_FUNDING_MULT * funding_bps
                = 40 + 0.9 * 56.44
                = 90.8 bps
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–æ–ø—É—Å—Ç–∏–º—ã–π –¥—Ä–æ–ø —Ü–µ–Ω—ã –¥–ª—è –≤—Ö–æ–¥–∞ (–µ—Å–ª–∏ —Ä—ã–Ω–æ–∫ —É–ø–∞–ª –±–æ–ª—å—à–µ ‚Üí SKIP)

### 2. Reference Price (ref_px_fix)
```
ref_px_fix = min(close_price, best_bid_fix)
            = min(0.25018, 0.25019)
            = 0.25018
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ admission (–Ω–µ –¥–ª—è —Ü–µ–Ω—ã –æ—Ä–¥–µ—Ä–∞!)

### 3. Limit Price (–≤ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏)
```
limit_px = ref_px * (1 - entry_bps_plan/10000) - ticks
          = 0.25018 * (1 - 0.00908) - 4*0.00001
          = 0.24789
```
**–í –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:** `limit_px = best_bid_open - entry_ticks * tick` (–≤ –º–æ–º–µ–Ω—Ç SEND)

## –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è

### REST (–¥–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–∫–Ω–∞):
- ‚úÖ `short_before` - —Ç–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è (13:59:18)
- ‚úÖ `funding_rate` - —Å—Ç–∞–≤–∫–∞ —Ñ–∞–Ω–¥–∏–Ω–≥–∞
- ‚úÖ `next_funding_time` - –≤—Ä–µ–º—è payout
- ‚úÖ `filters` (tickSize, qtyStep) - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

### WebSocket (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ):
- ‚úÖ **Public WS**: orderbook.1, publicTrade, tickers
- ‚úÖ **Trade WS**: order.create (–æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤)
- ‚úÖ **Private WS**: order, execution, position (—Å—Ç–∞—Ç—É—Å—ã)

### –í –º–æ–º–µ–Ω—Ç OPEN SEND:
- ‚úÖ **WS snapshot**: `best_bid_open` (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)
- ‚úÖ **Admission check**: `down_bps = (ref_px_fix - best_bid_open) / ref_px_fix * 10000`
- ‚úÖ –ï—Å–ª–∏ `down_bps > entry_bps_plan` ‚Üí **SKIP** (–Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º)

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –æ–∫–Ω–æ (13:59:59 - 14:00:00)

```
13:59:59.225  WS FIX (snapshot –¥–ª—è ref_px_fix)
13:59:59.255  OPEN SEND (snapshot best_bid_open + –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ä–¥–µ—Ä–∞)
13:59:59.438  OPEN ACK (–ø–æ–ª—É—á–µ–Ω–∏–µ order_id)
13:59:59.495  OPEN FILLED (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ fill —á–µ—Ä–µ–∑ private WS)
14:00:00.455  CLOSE START (–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏)
```

**–í–∞–∂–Ω–æ:** –í –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –æ–∫–Ω–µ –ù–ï–¢ REST –∑–∞–ø—Ä–æ—Å–æ–≤ - —Ç–æ–ª—å–∫–æ WS snapshots!

